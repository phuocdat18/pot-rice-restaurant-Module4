<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densityDpi=device-dpi"/>
    <title>Chi tiết thực đơn || Nhà Hàng Cơm Niêu HTD</title>
    <link rel="icon" href="/assets/images/logo_icon.png">
    <th:block th:replace="layout/header"/>

    <link rel="stylesheet" href="/assets/v5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/all.min.css">
    <link rel="stylesheet" href="/assets/sweetalert2/sweetalert2.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="/assets/v5.3.0/js/bootstrap.bundle.min.js"></script>


    <style>

        /* Đảm bảo thẻ label và thẻ input nằm trên cùng một dòng */
        .panel-default {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .payment-label {
            margin-right: 10px; /* Khoảng cách giữa label và input */
        }

        .content {
            padding: 10px;
        }

        .product-carts {
            display: flex;
            flex-wrap: wrap;
            float: left;
            margin-left: 0;
            margin-right: 0;
            padding-left: 100px;
        }

        .product-price-unit {
            display: flex;
            justify-content: space-between;
            margin-left: 0;
            margin-right: 0;
        }

        /*.product-price {*/
        /*    color: #ff6600;*/
        /*    font-weight: bold;*/
        /*}*/
        .product-cart {
            margin: 5px;
            padding: 0;
            float: left;
        }

        .card-footer {
            margin: 0;
            padding: 0;
            border: none;
        }

        .btnAddCart {
            width: 100%;
        }

        .payment {
            float: right;
            padding-right: 70px;
        }

        .invalid {
            border: 1px solid red;
        }

        .payment .payment_defult {
            margin-top: 20px;
        }

        .product-detail {
            border: none;
        }

        .quantity-input {
            margin: 0;
            width: 50px;
        }

        .changeQuantity {
            border: none;
            background-color: #fff;
            padding: 0;
        }

        .product_price {
            padding: 10px;
        }

        .current_price-format {
            color: red;
            font-weight: bolder;
        }

        .product-quantity {
            width: 70px;
        }

        #totalAmount {
            color: red;
        }

        .product-detail-title {
            padding: 50px;
        }

        .changqtt{
            background-color: #fd7e14;
            border: none;
            border-radius: 20px;
        }
        .changqtt:hover{
            background-color: #231f40;
        }
    </style>
</head>

<body>

<!--=============================
    TOPBAR START
==============================-->
<th:block th:replace="layout/topbar"/>
<!--=============================
    BREADCRUMB START
==============================-->
<section class="tf__breadcrumb" style="background: url('/assets/images/counter_bg.jpg');">
    <div class="tf__breadcrumb_overlay">
        <div class="container">
            <div class="tf__breadcrumb_text">
                <h1>Sản phẩm</h1>
                <ul>
                    <li><a href="/shop">Trang chủ</a></li>
                    <li><a href="#">Chi tiết</a></li>
                </ul>
            </div>
        </div>
    </div>
</section>
<!--=============================
    BREADCRUMB END
==============================-->


<!--=============================
    MENU DETAILS START
==============================-->
<section class="tf__menu_details mt_100 xs_mt_75 mb_95 xs_mb_65">
    <div class="container">
        <div class="row">
            <div class="col-lg-5 col-sm-10 col-md-9 wow fadeInUp" data-wow-duration="2s">

                <div >
                        <div class="exzoom_img_box tf__menu_details_images">
                        <ul >
                            <li>
                                <img class="zoom img-fluid w-100" data-wow-duration="2s" th:if="${product.avatar}"
                                     th:src="${product.avatar.getFileUrl()}" alt="product">
                            </li>
                        </ul>
                    </div>

                </div>

            </div>
            <div class="col-lg-7 wow fadeInUp" data-wow-duration="1s">
                <form method="post">
                    <div class="tf__menu_details_text">
                        <h1 th:text="${product.getTitle()}"></h1>
                        <div class="product_price">
                            <input class="current_price" th:value="${product.getPrice()}" hidden="true">
                            <span class="current_price-format"></span>
                        </div>
                        <p class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <i class="far fa-star"></i>
                            <span>(201)</span>
                        </p>

                        <div class="details_quentity">
                            <div class="quentity_btn_area d-flex flex-wrapa align-items-center">
                                <div class="quentity_btn">
<!--                                    <form onsubmit="return false;">-->
                                        <a class="btn btn-danger changqtt" onclick="changeQuantity(-1)"><i class="fal fa-minus"></i></a>
                                        <input id="quantityInput" type="text" placeholder="1" value="1">
                                        <a class="btn btn-success changqtt" onclick="changeQuantity(1)"><i class="fal fa-plus"></i></a>
<!--                                    </form>-->
                                </div>
                            </div>
                        </div>


                        <ul class="details_button_area d-flex flex-wrap">

                            <button type="button" class="tf__add_to_cart btn-addCart" id="btn-addCart" th:data-id="${product.getId()}" >
                                Thêm vào giỏ hàng
                            </button>
                        </ul>
                    </div>
                </form>
            </div>
            <div class="col-12 wow fadeInUp" data-wow-duration="1s">
                <div class="tf__menu_description_area mt_100 xs_mt_70">
                    <ul class="nav nav-pills" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home"
                                    aria-selected="true">Mô tả
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-contact" type="button" role="tab"
                                    aria-controls="pills-contact" aria-selected="false">Đánh giá
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                            <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                             aria-labelledby="pills-home-tab" tabindex="0">
                            <div class="menu_det_description">

                                <div class="product_desc">
                                    <p th:text="${product.getDescription()}"></p>
                                </div>

                            </div>
                        </div>
                        <div class="tab-pane fade" id="pills-contact" role="tabpanel"
                             aria-labelledby="pills-contact-tab" tabindex="0">
                            <div class="tf__review_area">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <h4>04 reviews</h4>
                                        <div class="tf__comment pt-0 mt_20">
                                            <div class="tf__single_comment m-0 border-0">
                                                <img src="/assets/images/client_1.png" alt="review"
                                                     class="img-fluid">
                                                <div class="tf__single_comm_text">
                                                    <h3>Michel Holder <span>29 oct 2022 </span></h3>
                                                    <span class="rating">
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fad fa-star-half-alt"></i>
                                                            <i class="fal fa-star"></i>
                                                            <b>(120)</b>
                                                        </span>
                                                    <p>Sure there isn't anything embarrassing hiidden in the
                                                        middles of text. All erators on the Internet
                                                        tend to repeat predefined chunks</p>
                                                </div>
                                            </div>
                                            <div class="tf__single_comment">
                                                <img src="/assets/images/client_2.png" alt="review"
                                                     class="img-fluid">
                                                <div class="tf__single_comm_text">
                                                    <h3>salina khan <span>29 oct 2022 </span></h3>
                                                    <span class="rating">
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fad fa-star-half-alt"></i>
                                                            <i class="fal fa-star"></i>
                                                            <b>(120)</b>
                                                        </span>
                                                    <p>Sure there isn't anything embarrassing hiidden in the
                                                        middles of text. All erators on the Internet
                                                        tend to repeat predefined chunks</p>
                                                </div>
                                            </div>
                                            <div class="tf__single_comment">
                                                <img src="/assets/images/client_3.png" alt="review"
                                                     class="img-fluid">
                                                <div class="tf__single_comm_text">
                                                    <h3>Mouna Sthesia <span>29 oct 2022 </span></h3>
                                                    <span class="rating">
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fad fa-star-half-alt"></i>
                                                            <i class="fal fa-star"></i>
                                                            <b>(120)</b>
                                                        </span>
                                                    <p>Sure there isn't anything embarrassing hiidden in the
                                                        middles of text. All erators on the Internet
                                                        tend to repeat predefined chunks</p>
                                                </div>
                                            </div>
                                            <div class="tf__single_comment">
                                                <img src="/assets/images/client_4.png" alt="review"
                                                     class="img-fluid">
                                                <div class="tf__single_comm_text">
                                                    <h3>marjan janifar <span>29 oct 2022 </span></h3>
                                                    <span class="rating">
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fad fa-star-half-alt"></i>
                                                            <i class="fal fa-star"></i>
                                                            <b>(120)</b>
                                                        </span>
                                                    <p>Sure there isn't anything embarrassing hiidden in the
                                                        middles of text. All erators on the Internet
                                                        tend to repeat predefined chunks</p>
                                                </div>
                                            </div>

                                            <div class="tf__pagination mt_30">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <nav aria-label="...">
                                                            <ul class="pagination">
                                                                <li class="page-item">
                                                                    <a class="page-link" href="#"><i
                                                                            class="fas fa-long-arrow-alt-left"></i></a>
                                                                </li>
                                                                <li class="page-item"><a class="page-link"
                                                                                         href="#">1</a></li>
                                                                <li class="page-item active"><a class="page-link"
                                                                                                href="#">2</a></li>
                                                                <li class="page-item"><a class="page-link"
                                                                                         href="#">3</a></li>
                                                                <li class="page-item">
                                                                    <a class="page-link" href="#"><i
                                                                            class="fas fa-long-arrow-alt-right"></i></a>
                                                                </li>
                                                            </ul>
                                                        </nav>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="col-lg-4">
                                        <div class="tf__post_review">
                                            <h4>write a Review</h4>
                                            <form>
                                                <p class="rating">
                                                    <span>select your rating : </span>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                </p>
                                                <div class="row">
                                                    <div class="col-xl-12">
                                                        <input type="text" placeholder="Name">
                                                    </div>
                                                    <div class="col-xl-12">
                                                        <input type="email" placeholder="Email">
                                                    </div>
                                                    <div class="col-xl-12">
                            <textarea rows="3"
                                      placeholder="Write your review"></textarea>
                                                    </div>
                                                    <div class="col-12">
                                                        <button class="common_btn" type="submit">submit
                                                            review
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="tf__related_menu mt_90 xs_mt_60">
            <h2>related item</h2>
            <div class="row related_product_slider">

                <!--        <div class="col-xl-3 wow fadeInUp" data-wow-duration="1s">-->
                <!--          <div class="tf__menu_item">-->
                <!--            <div class="tf__menu_item_img" title="product-detail" href="/shop/product-detail/${obj.id}">-->
                <!--              <img src="${imageUrl}" alt="menu" class="img-fluid w-100">-->
                <!--            </div>-->
                <!--            <div class="tf__menu_item_text">-->
                <!--              <a class="category" href="#">${obj.category.title}</a>-->
                <!--              <a class="title" title="Edit" href="/shop/product-detail/${obj.id}">${obj.title}</a>-->
                <!--            </div>-->
                <!--            <div class="tf__menu_item_text2">-->
                <!--              <p class="rating">-->
                <!--                <i class="fas fa-star"></i>-->
                <!--                <i class="fas fa-star"></i>-->
                <!--                <i class="fas fa-star"></i>-->
                <!--                <i class="fas fa-star-half-alt"></i>-->
                <!--                <i class="far fa-star"></i>-->
                <!--                <span>24</span>-->
                <!--              </p>-->
                <!--              <h5 class="price">${price}-->
                <!--              </h5>-->
                <!--              <input type="number" class="quantity-product" value="${obj.quantity}" hidden="true"></input>-->
                <!--            </div>-->
                <!--            <div class="tf__menu_item_text3">-->
                <!--              <a type="button" class="tf__add_to_cart btnAddCart" data-id="${obj.id}" href="#" data-bs-toggle="modal" data-bs-target="#cartModal">-->
                <!--                Add to cart-->
                <!--              </a>-->
                <!--              <ul class="d-flex flex-wrap justify-content-end">-->
                <!--                <li><a href="#"><i class="fal fa-heart"></i></a></li>-->
                <!--                <li><a href="menu_details.html"><i class="far fa-eye"></i></a></li>-->
                <!--              </ul>-->
                <!--            </div>-->
                <!--          </div>-->
                <!--        </div>-->

            </div>
        </div>
    </div>
</section>


<!--=============================
    MENU DETAILS END
==============================-->


<!--=============================
    FOOTER START
==============================-->
<th:block th:replace="layout/footer"/>

<link rel="stylesheet" href="/assets/css/slick.css">
<!--=============================
    FOOTER END
==============================-->


<!--=============================
    SCROLL BUTTON START
==============================-->
<div class="tf__scroll_btn">
    <i class="fas fa-hand-pointer"></i>
</div>
<!--=============================
    SCROLL BUTTON END
==============================-->


<ul class="menu_icon d-flex flex-wrap">
    <li>
        <a class="btn" style="color: white" href="/shop/cart"><i class="fas fa-shopping-basket"></i>
            <span class="cart-count" id="count-cart">0</span></a>
    </li>
</ul>
<link rel="stylesheet" href="/assets/css/style.css">

<!--jquery library js-->
<th:block th:replace="layout/script"/>

<script src="/assets/js/jquery.exzoom.js"></script>
<script src="/assets/js/main.js"></script>
<script src="/assets/sweetalert2/sweetalert2.all.min.js"></script>




<script>
    const page = {
        urls: {
            getAllCategories: AppBase.API_CATEGORY,
            getAllProducts: AppBase.API_PRODUCT,
            getAllCartDetails: AppBase.API_CART_DETAIL,
            getAddToCart: AppBase.API_ADD_TO_CART,
            getPayment: AppBase.API_PAYMENT,
            getDelete: AppBase.API_DELETED_CART_ITEM,
            getChangeQuantity: AppBase.API_CHANGE_QUANTITY,
            getSearch: AppBase.API_SEARCH_PRODUCT,

            getAllProvinces: 'https://vapi.vnappmob.com/api/province/',
            getAllDistricts: 'https://vapi.vnappmob.com/api/province/district/',
            getAllWards: 'https://vapi.vnappmob.com/api/province/ward/'
        },
        elements: {},
        commands: {},
        dialogs: {
            elements: {},
            loadData: {},
            commands: {}
        },
    }

    page.elements.productCarts = $('#product-carts')
    page.elements.exzoomNav = $('#exzoom_nav')
    page.elements.relatedProductSlider = $('.related_product_slider')
    page.elements.inputSearch = $('#search')
    page.elements.btnSearch = $('.btn-search')


    page.dialogs.elements.tbCart = $('#tbCart tbody')
    page.dialogs.elements.modalCart = $('#mdCart')
    page.dialogs.elements.totalAmount = $('#totalAmount')

    page.dialogs.elements.btnAddCart = $('.btnAddCart')
    page.elements.countCart = $('#count-cart')

    page.dialogs.elements.payment = $('.payment-cart')
    page.dialogs.elements.cancelPayment = $('.cancel-cart')

    page.dialogs.elements.paymentDefult = $('#payment_defult')
    page.dialogs.elements.frmPayment = $('#frmPayment')
    page.dialogs.elements.changeQuantity = $('.changeQuantity')

    page.elements.pagination = $('.pagination')


    page.dialogs.elements.provinceCr = $('#provinceCr')
    page.dialogs.elements.districtCr = $('#districtCr')
    page.dialogs.elements.wardCr = $('#wardCr')
    page.dialogs.elements.addressCr = $('#addressCr')

    page.commands.getAllProducts = (pageProduct, pageSize) => {
        $.ajax({
            type: 'GET',
            url: page.urls.getAllProducts,
            data: {
                page: pageProduct,
                pageSize: pageSize
            }
        })
            .done((data) => {

                page.commands.loadProduct(data.content);
                page.commands.displayPagination(data.totalPages, data.number + 1);

                page.commands.doAddToCart();
                page.commands.showCart();

            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    }

    page.commands.loadProduct = (products) => {
        page.elements.productCarts.empty();
        page.elements.relatedProductSlider.empty();
        // page.elements.exzoomNav.empty();

        $.each(products, (index, item) => {
            const str = page.commands.renderProduct(item);
            // const exzoom = page.commands.renderImage(item);
            page.elements.productCarts.prepend(str)
            // page.elements.exzoomNav.prepend(exzoom)
            page.elements.relatedProductSlider.prepend(str);
        })

        $('.related_product_slider').slick({
            slidesToShow: 4,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: 4000,
            dots: false,
            arrows: true,
            nextArrow: '<i class="far fa-long-arrow-right nextArrow"></i>',
            prevArrow: '<i class="far fa-long-arrow-left prevArrow"></i>',

            responsive: [
                {
                    breakpoint: 1400,
                    settings: {
                        slidesToShow: 4,
                    }
                },
                {
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: 3,
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: 2,
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 2,
                    }
                },
                {
                    breakpoint: 576,
                    settings: {
                        arrows: false,
                        slidesToShow: 1,
                    }
                }
            ]
        });
    }



    page.commands.displayPagination = (totalPages, currentPage) => {
        page.elements.pagination.empty();

        let previousBtn = '<li class="page-item"><a class="page-link" href="#" onclick="page.commands.getAllProducts(' + (currentPage - 1) + ', 10)">Previous</a></li>';
        page.elements.pagination.append(previousBtn);

        for (let i = 1; i <= totalPages; i++) {
            let pageBtn = '<li class="page-item ' + (i === currentPage ? 'active' : '') + '"><a class="page-link" href="#" onclick="page.commands.getAllProducts(' + i + ', 10)">' + i + '</a></li>';
            page.elements.pagination.append(pageBtn);
        }

        let nextBtn = '<li class="page-item"><a class="page-link" href="#" onclick="page.commands.getAllProducts(' + (currentPage + 1) + ', 10)">Next</a></li>';
        page.elements.pagination.append(nextBtn);
    };

    page.commands.renderProduct = (obj) => {
        const imageUrl = AppBase.BASE_URL_CLOUD_IMAGE + '/' + AppBase.IMAGE_SCALE_W_280_h_180_Q_100 + '/' + obj.avatar.fileFolder + '/' + obj.avatar.fileName;
        const price = obj.price.toLocaleString('vi', {style: 'currency', currency: 'VND'});
        return `
                 <div class="col-xl-3 col-sm-6 col-lg-4 wow fadeInUp" data-wow-duration="1s">
                <div class="tf__menu_item">
                    <div class="tf__menu_item_img" title="product-detail" href="/shop/product-detail/${obj.id}">
                        <img src="${imageUrl}" alt="menu" class="img-fluid w-100">

<!--                        <img src="${imageUrl}" alt="menu" class="img-fluid w-100">-->
                    </div>
                    <div class="tf__menu_item_text">
                        <a class="category" href="#">${obj.category.title}</a>
                        <a class="title" title="Edit" href="/shop/product-detail/${obj.id}">${obj.title}</a>
                    </div>
                    <div class="tf__menu_item_text2">
                            <p class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <i class="far fa-star"></i>
                            <span>24</span>
                        </p>
                        <h5 class="price">${price}
                        </h5>
                        <input type="number" class="quantity-product" value="${obj.quantity}" hidden="true"></input>
                    </div>
                    <div class="tf__menu_item_text3">
                        <a type="button" class="tf__add_to_cart btnAddCart" data-id="${obj.id}"  data-bs-toggle="modal" data-bs-target="#cartModal">
                            Add to cart
                        </a>
                        <ul class="d-flex flex-wrap justify-content-end">
                            <li><a href="#"><i class="fal fa-heart"></i></a></li>
                            <li><a href="/shop/product-detail/${obj.id}"><i class="far fa-eye"></i></a></li>
                        </ul>
                    </div>
                </div>
                </div>
           `;
    }


    page.commands.getAllCartDetail = () => {
        $.ajax({
            type: 'GET',
            url: page.urls.getAllCartDetails
        })
            .done((data) => {
                let totalAmount = 0;
                let count = 0;
                $.each(data, (index, item) => {
                    const str = page.commands.renderCart(item);
                    totalAmount = totalAmount + item.amount;
                    page.dialogs.elements.tbCart.prepend(str)
                    count = count + item.quantity
                })
                page.elements.countCart.text(count)
                page.dialogs.elements.totalAmount.text(totalAmount.toLocaleString('vi', {
                    style: 'currency',
                    currency: 'VND'
                }));
                page.commands.deleteProduct();
                page.commands.changeQuantity();
            })
            .fail((jqXHR) => {
                AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageVi.ERROR_404);
            })
    }

    page.commands.renderCart = (obj) => {
        const imageUrl = AppBase.BASE_URL_CLOUD_IMAGE + '/' + AppBase.IMAGE_SCALE_W_280_h_180_Q_100 + '/' + obj.productDTO.avatar.fileFolder + '/' + obj.productDTO.avatar.fileName;
        const price = obj.price.toLocaleString('vi', {style: 'currency', currency: 'VND'});
        const amount = obj.amount.toLocaleString('vi', {style: 'currency', currency: 'VND'});
        return `
                <tr id="tr_${obj.id}">
                    <td>
                        <span class="product-id">${obj.id}</span>
                    </td>
                    <td>${obj.title}</td>
                    <td>
                         <img src="${imageUrl}" class="card-img-top" alt="...">
                    </td>
                    <td>${obj.unit}</td>
                    <td>
                        <span class="price-obj" hidden="true">${obj.price}</span>
                        <span class="price">${price}</span>
                    </td>
                    <td>
                        <button type="button" class="changeQuantity" data-id="${obj.id}">
                            <input class="quantity-input" name="quantity" min="1" max="100" value="${obj.quantity}" type="number">
                        </button>
                    </td>
                    <td>
                        <span class="amount">${amount}</span>
                    </td>
                    <td>
                        <a class="btn btn-outline-danger delete" data-id="${obj.id}" >
                            <i class="far fa-trash-alt"></i>
                        </a>
                    </td>
                </tr>
            `;
    }

    page.commands.getProductById = (productId) => {
        return $.ajax({
            type: 'GET',
            url: page.url.getAllProduct + '/' + productId
        });
    }


    page.commands.search = (pageProduct, pageSize) => {
        let keyword = page.elements.inputSearch.val();
        let categoryIds = '';
        $("input[name='category']:checked").each(function () {
            categoryIds = categoryIds + $(this).val() + ',';
        });


        let priceRanges = [];
        let minPrice, maxPrice;
        let count = 0;
        if ($("#p1").is(":checked")) {
            count += 1;
            priceRanges.push(+$("#p1").data('minprice'));
            priceRanges.push(+$("#p1").data('maxprice'));
        }
        if ($("#p2").is(":checked")) {
            count += 1;
            priceRanges.push(+$("#p2").data('minprice'));
            priceRanges.push(+$("#p2").data('maxprice'));
        }
        if ($("#p3").is(":checked")) {
            count += 1;
            priceRanges.push(+$("#p3").data('minprice'));
            priceRanges.push($("#p3").data('maxprice'));
        }
        if ($("#p4").is(":checked")) {
            count += 1;
            priceRanges.push(+$("#p4").data('minprice'));
            priceRanges.push(+$("#p4").data('maxprice'));
        }
        if ($("#p5").is(":checked")) {
            count += 1;
            priceRanges.push(+$("#p5").data('minprice'));
            priceRanges.push(+$("#p5").data('maxprice'));
        }
        priceRanges.sort(function (a, b) {
            return a - b
        });
        if (count === 0) {
            minPrice = '';
            maxPrice = '';
        } else {
            minPrice = Number(priceRanges[0]);
            maxPrice = Number(priceRanges[priceRanges.length - 1]);
        }


        console.log(minPrice)
        console.log(maxPrice)
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: 'GET',
            url: page.urls.getSearch,
            data: {
                search: keyword,
                ids: categoryIds,
                minPrice: minPrice,
                maxPrice: maxPrice,
                page: pageProduct,
                pageSize: pageSize
            },
            dataType: 'json',
        })
            .done((data) => {
                if (data === undefined) {
                    page.elements.pagination.empty();
                    page.elements.productCarts.empty();
                    AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageEn.ERROR_FIND_PRODUCT);
                }

                page.commands.loadProduct(data.content);
                page.commands.displayPaginationSearch(data.totalPages, data.number + 1);

                page.commands.doAddToCart();
                page.commands.showCart();
            })
            .fail((jqXHR) => {
                AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageVi.ERROR_404);
            })
    }

    page.commands.displayPaginationSearch = (totalPages, currentPage) => {

        page.elements.pagination.empty();

        let previousBtn = '<li class="page-item"><a class="page-link" href="#" onclick="page.commands.search(' + (currentPage - 1) + ', 10)">Previous</a></li>';
        page.elements.pagination.append(previousBtn);

        for (let i = 1; i <= totalPages; i++) {
            let pageBtn = '<li class="page-item ' + (i === currentPage ? 'active' : '') + '"><a class="page-link" href="#" onclick="page.commands.search(' + i + ', 10)">' + i + '</a></li>';
            page.elements.pagination.append(pageBtn);
        }

        let nextBtn = '<li class="page-item"><a class="page-link" href="#" onclick="page.commands.search(' + (currentPage + 1) + ', 10)">Next</a></li>';
        page.elements.pagination.append(nextBtn);
    };


    page.commands.showCart = () => {
        $('.modal-cart').on('click', () => {
            page.commands.addEventChangeProvince();
            page.commands.addEventChangeDistrict();
            page.dialogs.elements.modalCart.addClass('show');
            page.dialogs.elements.modalCart.modal('show');
            page.commands.closeFrmPayment();
            $("#mdCart .modal-alert-danger").removeClass("show").addClass("hide").empty();
        })
    }

    page.commands.doAddToCart = () => {
        $('.btnAddCart').on('click', function () {
            let productId = $(this).data('id');
            let cartItem = {
                productId: productId,
                quantity: 1
            }
            // console.log(quantityInput)
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                type: 'POST',
                url: page.urls.getAddToCart,
                data: JSON.stringify(cartItem)
            })
                .done((data) => {
                    page.dialogs.elements.tbCart.empty();
                    let totalAmount = 0;
                    let count = 0;
                    $.each(data, (index, item) => {
                        const str = page.commands.renderCart(item);
                        totalAmount = totalAmount + item.amount;
                        page.dialogs.elements.tbCart.prepend(str)
                        count = count + item.quantity
                    })
                    page.elements.countCart.text(count)
                    page.dialogs.elements.totalAmount.text(totalAmount.toLocaleString('vi', {
                        style: 'currency',
                        currency: 'VND'
                    }));
                    page.commands.deleteProduct();
                    page.commands.changeQuantity();
                })
                .fail((err) => {
                    AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageVi.ERROR_404);
                })
        })
    }

    page.commands.deleteProduct = () => {
        $('.delete').on('click', function () {
            let cartDetailId = $(this).data('id')
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085D6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    page.dialogs.commands.doDelete(cartDetailId);
                }
            })
        })
    }

    page.dialogs.commands.doDelete = (cartDetailId) => {
        $.ajax({
            type: "DELETE",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: page.urls.getDelete + '/' + cartDetailId,
        }).done((data) => {

            AppBase.SweetAlert.showSuccessAlert(AppBase.AlertMessageEn.SUCCESS_DELETED);

            page.dialogs.elements.tbCart.empty();
            let totalAmount = 0;
            let count = 0;
            $.each(data, (index, item) => {
                const str = page.commands.renderCart(item);
                totalAmount = totalAmount + item.amount;
                page.dialogs.elements.tbCart.prepend(str)
                count = count + item.quantity
            })
            page.elements.countCart.text(count)
            page.dialogs.elements.totalAmount.text(totalAmount.toLocaleString('vi', {
                style: 'currency',
                currency: 'VND'
            }));
            page.commands.deleteProduct();
            page.commands.changeQuantity();

            page.commands.handleImagePopup();

        }).fail(function (jqXHR) {
            AppBase.SweetAlert.showErrorAlert(jqXHR.responseJSON.message);
        })
    }


    page.commands.closeFrmPayment = () => {
        $('.btnClose').on('click', () => {
            page.dialogs.elements.frmPayment.trigger("reset");
            $("#mdCart .modal-alert-danger").removeClass("show").addClass("hide").empty();
            $("#frmPayment input.error").removeClass("error");
        })
    }

    page.commands.changeQuantity = () => {
        $('.changeQuantity').on('click', function () {
            let cartDetailId = $(this).data('id');
            let quantity = $(this).find('.quantity-input').val()
            if (Number(quantity) <= 0) {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085D6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        page.dialogs.commands.doDelete(cartDetailId);
                    } else {
                        $('.quantity-input').val('1')
                    }
                })
            } else {
                let cartDetail = {
                    quantity: quantity
                }
                $.ajax({
                    type: "PATCH",
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    url: page.urls.getChangeQuantity + '/' + cartDetailId,
                    data: JSON.stringify(cartDetail)
                })
                    .done((data) => {
                        page.dialogs.elements.tbCart.empty();
                        let totalAmount = 0;
                        let count = 0;
                        $.each(data, (index, item) => {
                            const str = page.commands.renderCart(item);
                            totalAmount = totalAmount + item.amount;
                            page.dialogs.elements.tbCart.prepend(str)
                            count = count + item.quantity
                        })
                        page.elements.countCart.text(count)
                        page.dialogs.elements.totalAmount.text(totalAmount.toLocaleString('vi', {
                            style: 'currency',
                            currency: 'VND'
                        }));
                        page.commands.deleteProduct();
                        page.commands.changeQuantity();
                    })
                    .fail((err) => {
                        console.log(err)
                        AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageVi.ERROR_404);
                    })
            }
        })
    }


    page.commands.getPayment = () => {
        let pay = $('.payment_defult:checked').val();

        let bill = new Bill();
        if (pay === 'momo') {
            bill = {
                locationRegionReqDTO: {
                    provinceId: page.dialogs.elements.provinceCr.val(),
                    provinceName: page.dialogs.elements.provinceCr.find('option:selected').text(),
                    districtId: page.dialogs.elements.districtCr.val(),
                    districtName: page.dialogs.elements.districtCr.find('option:selected').text(),
                    wardId: page.dialogs.elements.wardCr.val(),
                    wardName: page.dialogs.elements.wardCr.find('option:selected').text(),
                    address: page.dialogs.elements.addressCr.val()
                },
                status: "DONE"
            }
        }
        if (pay === 'cod') {
            bill = {
                locationRegionReqDTO: {
                    provinceId: page.dialogs.elements.provinceCr.val(),
                    provinceName: page.dialogs.elements.provinceCr.find('option:selected').text(),
                    districtId: page.dialogs.elements.districtCr.val(),
                    districtName: page.dialogs.elements.districtCr.find('option:selected').text(),
                    wardId: page.dialogs.elements.wardCr.val(),
                    wardName: page.dialogs.elements.wardCr.find('option:selected').text(),
                    address: page.dialogs.elements.addressCr.val()
                },
                status: "ORDER"
            }
        }
        console.log(bill)
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: 'POST',
            url: page.urls.getPayment,
            data: JSON.stringify(bill)
        })
            .done((data) => {
                console.log(data)
                AppBase.SweetAlert.showSuccessAlert(AppBase.AlertMessageEn.SUCCESS_PAYMENT);
                page.dialogs.elements.tbCart.empty()
                page.commands.getAllCartDetail();
                page.dialogs.elements.modalCart.removeClass('show');
                page.dialogs.elements.modalCart.modal('hide')

                $('#totalAmount').text('');
                page.dialogs.elements.frmPayment.trigger("reset");
                $("#mdCart .modal-alert-danger").removeClass("show").addClass("hide").empty();
                $("#frmPayment input.error").removeClass("error");
            })
            .fail((jqXHR) => {

                AppBase.SweetAlert.showErrorAlert(jqXHR.responseJSON.message);
            })
    }

    page.dialogs.loadData.getAllProvinces = () => {
        return $.ajax({
            headers: {
                'accept': 'application/json',
                'content-type': 'application/json'
            },
            type: 'GET',
            url: page.urls.getAllProvinces,
        })
            .done((res) => {
                const data = res.results
                page.dialogs.elements.provinceCr.empty();
                $.each(data, (index, item) => {
                    let str = `<option value="${item.province_id}">${item.province_name}</option>`;
                    page.dialogs.elements.provinceCr.append(str);
                })
            })
            .fail((jqXHR) => {
                AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageVi.ERROR_400);
            })

    }

    page.commands.addEventChangeProvince = () => {
        page.dialogs.elements.provinceCr.on("change", function () {
            let provinceId = $(this).val();
            if (provinceId !== 0) {
                page.dialogs.loadData.getAllDistricts(provinceId).then(() => {
                    let districtId = page.dialogs.elements.districtCr.val();
                    page.dialogs.loadData.getAllWards(districtId);
                })
            }
        })
    }


    page.dialogs.loadData.getAllDistricts = (provinceId) => {
        return $.ajax({
            headers: {
                'accept': 'application/json',
                'content-type': 'application/json'
            },
            type: 'GET',
            url: page.urls.getAllDistricts + provinceId,
        })
            .done((res) => {
                const data = res.results
                page.dialogs.elements.districtCr.empty();
                $.each(data, (index, item) => {
                    let str = `<option value="${item.district_id}">${item.district_name}</option>`;
                    page.dialogs.elements.districtCr.append(str);
                })
            })
            .fail((jqXHR) => {
                AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageVi.ERROR_400);
            })
    }

    page.commands.addEventChangeDistrict = () => {

        page.dialogs.elements.districtCr.on("change", function () {
            let districtId = $(this).val();
            if (districtId !== 0) {
                page.dialogs.loadData.getAllWards(districtId);
            }

        })
    }

    page.dialogs.loadData.getAllWards = (districtId) => {
        return $.ajax({
            headers: {
                'accept': 'application/json',
                'content-type': 'application/json'
            },
            type: 'GET',
            url: page.urls.getAllWards + districtId,
        })
            .done((res) => {
                const data = res.results
                page.dialogs.elements.wardCr.empty();
                $.each(data, (index, item) => {
                    let str = `<option value="${item.ward_id}">${item.ward_name}</option>`;
                    page.dialogs.elements.wardCr.append(str);
                })
            })
            .fail((jqXHR) => {
                AppBase.SweetAlert.showErrorAlert(AppBase.AlertMessageVi.ERROR_400);
            })
    }

    page.commands.resetLocationRegion = () => {
        page.dialogs.loadData.getAllProvinces().then(() => {
            const provinceId = page.dialogs.elements.provinceCr.val()
            page.dialogs.loadData.getAllDistricts(provinceId).then(() => {
                const districtId = page.dialogs.elements.districtCr.val()
                page.dialogs.loadData.getAllWards(districtId)
            });
        });
    }

    page.dialogs.elements.frmPayment.validate({
        rules: {
            payment_method: {
                required: true,
            },
            provinceCr: {
                required: true,
            },
            districtCr: {
                required: true,
            },
            wardCr: {
                required: true,
            },
            addressCr: {
                required: true,
                minlength: 5,
                maxlength: 100
            }
        },
        messages: {
            payment_method: {
                required: "Vui lòng chọn phương thức thanh toán.",
            },
            provinceCr: {
                required: "Select province",
            },
            districtCr: {
                required: "Select district",
            },
            wardCr: {
                required: "Select ward"
            },
            addressCr: {
                required: 'Địa chỉ không được để trống',
                minlength: 'Địa chỉ không được nhỏ hơn ${0} ký tự',
                maxlength: 'Địa chỉ không được quá ${0} ký tự'
            }
        },
        errorLabelContainer: "#mdCart .modal-alert-danger",
        errorPlacement: function (error, element) {
            error.appendTo("#mdCart .modal-alert-danger");
        },
        showErrors: function (errorMap, errorList) {
            if (this.numberOfInvalids() > 0) {
                $("#mdCart .modal-alert-danger").removeClass("hide").addClass("show");
            } else {
                $("#mdCart .modal-alert-danger").removeClass("show").addClass("hide").empty();
                $("#frmPayment input.error").removeClass("error");
            }
            this.defaultShowErrors();
        },
        submitHandler: function () {
            page.commands.getPayment();
        }
    })


    page.loadData = () => {
        page.commands.getAllCartDetail();
        page.commands.getAllProducts(1, 8);
        page.commands.resetLocationRegion();

    }

    page.initializeControlEvent = () => {
        page.dialogs.elements.payment.on('click', () => {
            page.dialogs.elements.frmPayment.trigger('submit');
        });

        $("#search").on('keydown', (event) => {
            if (event.keyCode === 13) {
                event.preventDefault();
                page.commands.search(1, 8);
            }
        });
        $('.btn-search').on('click', () => {
            page.commands.search(1, 8);
        });

        // setTimeout(() => {
        //     $('.exzoom_img_ul:eq(1)').css('display', 'none');
        // }, 100)


    }

    $(() => {
        page.loadData();
        page.initializeControlEvent();
    })


    // Hàm định dạng giá tiền thành 1.000.000 đ
    function formatPrice(price) {
        // Sử dụng hàm toLocaleString() để format số thành chuỗi có dấu chấm phân cách hàng nghìn
        return parseFloat(price).toLocaleString() + " đ";
    }

    // Lấy giá trị từ input
    var inputElement = document.querySelector(".current_price");
    var inputValue = inputElement.value;

    // Lấy đối tượng span
    var spanElement = document.querySelector(".current_price-format");

    // Gán giá trị đã format vào span
    spanElement.innerText = formatPrice(inputValue);

    var quantityInput = document.getElementById("quantityInput");

    // Kiểm tra giá trị nhập vào phải là số dương
    quantityInput.addEventListener("input", function() {
        if (quantityInput.value < 0) {
            // Nếu không phải số dương thì đặt giá trị mặc định là 1
            quantityInput.value = "1";
        }
    });


    function changeQuantity(value) {
        // Lấy giá trị hiện tại của ô nhập liệu
        var quantityInput = document.getElementById("quantityInput");
        var currentValue = parseInt(quantityInput.value);

        // Kiểm tra nếu giá trị là số hợp lệ (không phải NaN)
        if (!isNaN(currentValue)) {
            // Tính giá trị mới
            var newValue = currentValue + value;

            // Đảm bảo giá trị mới không nhỏ hơn 1
            if (newValue < 1) {
                newValue = 1;
            }

            // Cập nhật giá trị mới vào ô nhập liệu
            quantityInput.value = newValue;
        }
    }


</script>

</body>

</html>
